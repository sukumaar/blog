---
import { getCollection, type CollectionEntry } from "astro:content";
import { Card, CardGrid } from "@astrojs/starlight/components";

// Define a shorthand type for cleaner code
type DocEntry = CollectionEntry<"docs">;

const { posts: propsPosts } = Astro.props as { posts: DocEntry[] };

let rawPosts: DocEntry[] = propsPosts;

if (!rawPosts) {
  rawPosts = await getCollection("docs", ({ id }) => id.startsWith("p/"));
}

const posts = rawPosts
  .filter((x: DocEntry) => !x.id.endsWith("index"))
  .sort((a: DocEntry, b: DocEntry) => {
    const dateA = a.data.date?.valueOf() ?? 0;
    const dateB = b.data.date?.valueOf() ?? 0;
    return dateB - dateA;
  });
---

{
  posts.map(
    (
      post: DocEntry, // <--- Add the type here!
    ) => (
      <Card title={post.data.title} icon="document">
        <div class="not-content card-inner">
          <div style="margin-top: -1rem; margin-bottom: 1rem; font-size: 0.8rem; opacity: 0.7;">
            <p>
              {post.data.date?.toLocaleDateString(undefined, {
                dateStyle: "medium",
              })}
            </p>
            <p>{post.data.author}</p>
          </div>

          <p>
            {post.data.description &&
              post.data.description.split(" ").slice(0, 25).join(" ")}
            ...
          </p>
          <a href={`/${post.id}`} class="stretched-link">
            Read Post â†’
          </a>
        </div>
      </Card>
    ),
  )
}

<style>
  /* 1. Make the Card a relative container for the link */
  :global(.sl-card) {
    position: relative;
    transition:
      transform 0.2s ease,
      border-color 0.2s ease;
  }

  :global(.sl-card:hover) {
    transform: translateY(-3px);
    border-color: var(--sl-color-accent);
  }

  /* 2. The magic "Stretched Link" CSS */
  .stretched-link {
    display: inline-block;
    margin-top: 1rem;
    font-weight: bold;
    text-decoration: none;
    color: var(--sl-color-accent-high);
  }

  .stretched-link::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1;
  }

  .card-inner {
    position: relative;
    z-index: 2; /* Ensures text stays readable but click goes through */
  }
</style>
