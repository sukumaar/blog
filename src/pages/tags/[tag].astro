---
import { getCollection } from "astro:content";
import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";
import BlogList from "../../components/BlogList.astro"; // Reuse your existing component

export async function getStaticPaths() {
    const allDocs = await getCollection("docs");
    // Get unique list of all tags from all documents
    const tags = [...new Set(allDocs.flatMap((doc) => doc.data.tags || []))];

    return tags.map((tag) => {
        return {
            params: { tag: tag.toLowerCase().replace(/\s+/g, "-") },
            props: { tagName: tag },
        };
    });
}

const { tag } = Astro.params;
const { tagName } = Astro.props;

// Filter posts that include this specific tag
const posts = await getCollection("docs", ({ data }) => {
    return data.tags?.some((t) => t.toLowerCase().replace(/\s+/g, "-") === tag);
});
---

<StarlightPage
    frontmatter={{ title: `Posts tagged: ${tagName}`, template: "splash" }}
>
    <BlogList posts={posts} />
</StarlightPage>
